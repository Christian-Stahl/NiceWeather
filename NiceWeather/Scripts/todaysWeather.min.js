
// Synca detta och gör en ny mini
// function getQueryStringParameter(urlParameterKey) { var params = document.URL.split('?')[1].split('&'); var strParams = ''; for (var i = 0; i < params.length; i = i + 1) { var singleParam = params[i].split('='); if (singleParam[0] == urlParameterKey) return decodeURIComponent(singleParam[1]) } } jQuery.noConflict(); (function ($) { var urlForecast = 'https://api.forecast.io/forecast/'; var telize = 'https://www.telize.com/geoip?callback=?'; var apiKey = getQueryStringParameter('appKey'); var unit = getQueryStringParameter('Unit'); var translationLang = getQueryStringParameter('Language'); var AutoPositionDetection = getQueryStringParameter('AutoPositionDetection'); var latitudeSetting = getQueryStringParameter('Latitude'); var longitudeSetting = getQueryStringParameter('Longitude'); var customCitySetting = getQueryStringParameter('customCity'); jQuery.ajax({ url: telize, cache: true, type: 'GET', dataType: 'jsonp', success: function (location) { if (AutoPositionDetection == 'Yes') { var lati = location.latitude; var longi = location.longitude } else { var lati = latitudeSetting; var longi = longitudeSetting } jQuery.ajax({ url: urlForecast + apiKey + "/" + lati + "," + longi + "?callback=?&units=" + unit + '&lang=' + translationLang, type: 'GET', dataType: 'jsonp', timeout: 3500, success: function (data) { var unitScale = ""; if (unit == 'si') { unitScale = '&deg;C' } else { unitScale = '&deg;F' } if (customCitySetting != '') { $('.cwLocation h1').html(customCitySetting) } else { $('.cwLocation h1').html(location.city) } $('.cwInfoDeltaHumPercent').html('%'); $('.unitScale').html(unitScale); $('.cwTempInt').html(data.currently.temperature.toFixed(0)); $('.cwDescription h1').html(data.currently.summary); var currIcon = data.currently.icon; switch (currIcon) { case "clear-day": $('.cwIconPlaceholder').addClass("cwIconPlaceholderSunSpin").append('<img src="../images/tick/sunny.png">'); break; case "clear-night": $('.cwIconPlaceholder').append('<img src="../images/tick/sunny_night.png">'); break; case "rain": $('.cwIconPlaceholder').append('<img src="../images/tick/hail.png">'); break; case "snow": $('.cwIconPlaceholder').append('<img src="../images/tick/snow4.png">'); break; case "sleet": $('.cwIconPlaceholder').append('<img src="../images/tick/sleet.png">'); break; case "wind": $('.cwIconPlaceholder').append('<img src="../images/tick/cloudy5.png">'); break; case "fog": $('.cwIconPlaceholder').append('<img src="../images/tick/mist.png">'); break; case "cloudy": $('.cwIconPlaceholder').append('<img src="../images/tick/cloudy5.png">'); break; case "partly-cloudy-day": $('.cwIconPlaceholder').append('<img src="../images/tick/cloudy2.png">'); break; case "partly-cloudy-night": $('.cwIconPlaceholder').append('<img src="../images/tick/cloudy1_night.png">'); break; default: $('.cwIconPlaceholder').append('<img src="../images/tick/cloudy5.png">'); break } $('.cwInfoGammaTemp').html(data.daily.data[0].temperatureMin.toFixed(0)); $('.cwInfoBetaTemp').html(data.daily.data[0].temperatureMax.toFixed(0)); $('.cwInfoDeltaHum').html(data.currently.humidity.toString().substr(2)); $('.cwAlfaMaxTemp').html(data.daily.data[1].temperatureMax.toFixed(0)).addClass('cwExtTemp'); $('.cwExtDayAlfa').html(moment.unix(data.daily.data[1].time).format("dd")); $('.cwBetaMaxTemp').html(data.daily.data[2].temperatureMax.toFixed(0)).addClass('cwExtTemp'); $('.cwExtDayBeta').html(moment.unix(data.daily.data[2].time).format("dd")); $('.cwGammaMaxTemp').html(data.daily.data[3].temperatureMax.toFixed(0)).addClass('cwExtTemp'); $('.cwExtDayGamma').html(moment.unix(data.daily.data[3].time).format("dd")); $('.cwDeltaMaxTemp').html(data.daily.data[4].temperatureMax.toFixed(0)).addClass('cwExtTemp'); $('.cwExtDayDelta').html(moment.unix(data.daily.data[4].time).format("dd")); $('.cwEpsilonMaxTemp').html(data.daily.data[5].temperatureMax.toFixed(0)).addClass('cwExtTemp'); $('.cwExtDayEpsilon').html(moment.unix(data.daily.data[5].time).format("dd")); var skycons = new Skycons({ "color": "#555" }); var day1_icon = data.daily.data[1].icon; var day2_icon = data.daily.data[2].icon; var day3_icon = data.daily.data[3].icon; var day4_icon = data.daily.data[4].icon; var day5_icon = data.daily.data[5].icon; skycons.set('day1icon', day1_icon); skycons.set('day2icon', day2_icon); skycons.set('day3icon', day3_icon); skycons.set('day4icon', day4_icon); skycons.set('day5icon', day5_icon); skycons.play(); $(document).ready(function () { $('#cwWrapper').show() }) }, error: function (parsedjson) { if ($('.cwLocation').length) { $(document).ready(function () { $('#cwWrapper').show(); $('.cwExtendedInfo').hide(); $('.cwInfoBeta, .cwInfoGamma, .cwInfoDelta').hide(); $('.cwIconWrapper').addClass('cwNoResponse').html('The weather services in not responding, make sure to add a valid API key. Check the settings for the App. <br /><br />If you dont have a key yet you can get <a href="https://developer.forecast.io/register" target="_blank">a free key from here..</a> ') }) } } }) } }) })(jQuery);